(function(){(function(){var k=document.createElement("div"),l=!1;["Moz","Webkit","ms"].forEach(function(m){l|=m+"Animation" in k.style});return !!l})();document.createElement("input").setAttribute("type","file");window.navigator.userAgent.match(/Macintosh/);(function(){var k=document.createElement("div"),l=!1;["Moz","Webkit","ms"].forEach(function(m){l|=m+"Transition" in k.style});return !!l})();function O(){this.h=null;this.j=N;this.k=[]}function M(k){var l=new O;l.init(k);return l}var N="UNINITIALIZED",L="INITIALIZED",K={i:function(k,l){this.l=l.permissions.data[0]},param:"permissions"},I={n:{i:function(){}},o:{i:function(){},param:"email"},q:{i:function(){},param:"first_name"},s:{i:function(k){this.id=k.userID}},t:{i:function(){},param:"last_name"},u:{i:function(k,l){this.name=l.name},param:"name"},v:K,A:{i:function(){},param:"picture.type(large)"},p:{i:function(){}}};function G(k){this.m=k}O.prototype.init=function(k){function n(p){m.h=p}function l(){m.h=null}var m=this;this.j==L?k(m):(this.k.push(k),"INITIALIZING"!=this.j&&(this.j="INITIALIZING",window.fbAsyncInit=function(){a(m)},(document,"script","facebook-jssdk")))};O.prototype.getAuthResponse=function(){var k=new $.Deferred;FB.getAuthResponse()?k.resolve(FB.getAuthResponse()):FB.getLoginStatus(function(l){"connected"==l.status?k.resolve(l.authResponse):k.reject("UNAUTHORIZED")});return k.promise()};function o(k){var l=[],n;for(n in I){l.push(I[n])}var m=new $.Deferred;i(k,l).then(function(p){k.h=new G(p.l);m.resolve(k.h)}).fail(function(p){m.reject(p)});return m.promise()}function i(k,l){var m=new $.Deferred;k.getAuthResponse().then(function(n){for(var r=[],q=0;q<l.length;q++){var p=l[q];p.param&&r.push(p.param)}FB.api("/me?return_ssl_resources\x3d1\x26fields\x3d"+encodeURIComponent(r.join(",")),function(u){if("error" in u){m.reject("FB_API_ERROR")}else{for(var t={},s=0;s<l.length;s++){l[s].i.call(t,n,u)}m.resolve(t)}})}).fail(function(n){k.h=null;m.reject(n)});return m.promise()}function g(k,l){var m=new $.Deferred;i(k,[K]).then(function(p){var q=[];k.h&&(k.h.m=p.l);q=p.l;p=[];for(var n in l){null==q[l[n]]&&p.push(l[n])}m.resolve(p)}).fail(function(n){m.reject(n)});return m.promise()}function f(){var k=e,l=["email","user_photos","user_status"];function s(t){m.resolve(t)}function q(t){this.h=null;m.reject(t)}var r=[],p=k.h?k.h.m:[],n;for(n in l){null==p[l[n]]&&r.push(l[n])}var m=$.Deferred();0<r.length?FB.login(function(t){t.authResponse&&t.status?g(k,l).then(s).fail(q):m.reject("FB_API_ERROR")},{scope:r.join(",")}):g(k,l).then(s).fail(q);return m.promise()}function d(){function k(n){m.reject(n)}var l=e,m=new $.Deferred;l.getAuthResponse().then(function(n){c(n).then(function(p){m.resolve(p)}).fail(k)}).fail(k);return m.promise()}function c(k){var l=new $.Deferred;$.post("/login/_ajax/fb",{fbId:k.userID,fbToken:k.accessToken,fbTokenExpires:k.expiresIn}).done(function(m){l.resolve(m.redirect)}).fail(function(){l.reject("/login")});return l.promise()}var b=800,J=500,H=20,e;$(F);function F(){e=M(function(){j(!0)});0>=$("*:focus").length&&!("createTouch" in document)&&$("input[type\x3dtext]").first().focus();$("#forgot").on("click",function(){$("#loginForm").addClass("fade");setTimeout(function(){$("#loginForm").addClass("off")},b);$("#forgotForm").removeClass("off");setTimeout(function(){$("#forgotForm").removeClass("fade");"createTouch" in document||$("#forgotEmail").focus()},H);$(".error").text("");return !1});$("#unForgot").on("click",function(){$("#forgotForm").addClass("fade");setTimeout(function(){$("#forgotForm").addClass("off")},b);$("#loginForm").removeClass("off");setTimeout(function(){$("#loginForm").removeClass("fade");$("#loginUsername").focus()},H);$(".error").text("");return !1})}function j(k){var l=$("#facebookLoginButton");l.removeClass("disabled");if(k){l.on("click",h)}else{l.off("click")}}function h(k){function l(q){window.location.href=window._loginRedirect||q}function p(){window.clearInterval(n);$("#facebookLoginButton").text("Login with Facebook");$(".error").text("Logging in with Facebook failed.").show();j(!0)}k.preventDefault();var m=0;$(".error").text("");$("#facebookLoginButton").text("Logging you in");j(!1);var n=window.setInterval(function(){var q="....".substring(0,m++%4);$("#facebookLoginButton").text("Logging you in"+q)},J);f().then(function(){d().then(l).fail(p)}).fail(p)}})();