!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(c){function b(f,g){this.container=f,this.options=g,this.container.trigger("start"),this.init(),this.container.trigger("ready")}function d(i){function h(k,n){return n.toUpper()}var f={},j=i.data();for(var g in j){f[g.replace(/-(\w)/g,h)]=j[g]}return f}function e(h){var g={};if(g.height=parseInt(h.attr("height"),10),g.width=parseInt(h.attr("width"),10),0===g.height||0===g.width){var f=new Image;f.src=h.attr("src"),g.width=f.width,g.height=f.height}return g}var a=0;c.fn.mosaicflow=function(g){var f=Array.prototype.slice.call(arguments,0);return this.each(function(){var i=c(this),h=i.data("mosaicflow");h?"string"==typeof g&&h[g](f[1]):(g=c.extend({},c.fn.mosaicflow.defaults,g,d(i)),h=new b(i,g),i.data("mosaicflow",h))})},c.fn.mosaicflow.defaults={itemSelector:"> *",columnClass:"mosaicflow__column",minItemWidth:240,itemHeightCalculation:"auto"},b.prototype={init:function(){this.__uid=a++,this.__uidItemCounter=0,this.items=this.container.find(this.options.itemSelector),this.columns=c([]),this.columnsHeights=[],this.itemsHeights={},this.tempContainer=c("<div>").css({visibility:"hidden",width:"100%"}),this.workOnTemp=!1,this.autoCalculation="auto"===this.options.itemHeightCalculation,this.container.append(this.tempContainer);var f=this;this.items.each(function(){var h=c(this),g=h.attr("id");g||(g=f.generateUniqueId(),h.attr("id",g))}),this.container.css("visibility","hidden"),this.autoCalculation?c(window).load(c.proxy(this.refill,this)):this.refill(),c(window).resize(c.proxy(this.refill,this))},refill:function(){this.container.trigger("fill"),this.numberOfColumns=Math.floor(this.container.width()/this.options.minItemWidth),this.numberOfColumns<1&&(this.numberOfColumns=1);var f=this.ensureColumns();f&&(this.fillColumns(),this.columns.filter(":hidden").remove()),this.container.css("visibility","visible"),this.container.trigger("filled")},ensureColumns:function(){var g=this.columns.length,h=this.numberOfColumns;if(this.workingContainer=0===g?this.tempContainer:this.container,h>g){for(var k=h-g,j=0;k>j;j++){var i=c("<div>",{"class":this.options.columnClass});this.workingContainer.append(i)}}else{if(g>h){for(var f=g;f>=h;){this.columns.eq(f).hide(),f--}var l=g-h;this.columnsHeights.splice(this.columnsHeights.length-l,l)}}return h!==g?(this.columns=this.workingContainer.find("."+this.options.columnClass),this.columns.css("width",100/h+"%"),!0):!1},fillColumns:function(){for(var l=this.numberOfColumns,g=this.items.length,k=0;l>k;k++){var h=this.columns.eq(k);this.columnsHeights[k]=0;for(var j=k;g>j;j+=l){var i=this.items.eq(j),f=0;h.append(i),f=this.autoCalculation?i.outerHeight():parseInt(i.find("img").attr("height"),10),this.itemsHeights[i.attr("id")]=f,this.columnsHeights[k]+=f}}this.levelBottomEdge(this.itemsHeights,this.columnsHeights),this.workingContainer===this.tempContainer&&this.container.append(this.tempContainer.children()),this.container.trigger("mosaicflow-layout")},levelBottomEdge:function(m,j){for(;;){var k=c.inArray(Math.min.apply(null,j),j),g=c.inArray(Math.max.apply(null,j),j);if(k===g){return}var i=this.columns.eq(g).children().last(),f=m[i.attr("id")],h=j[k],l=j[g],n=h+f;if(n>=l){return}this.columns.eq(k).append(i),j[g]-=f,j[k]+=f}},add:function(j){this.container.trigger("add");var h=c.inArray(Math.min.apply(null,this.columnsHeights),this.columnsHeights),f=0;if(this.autoCalculation){j.css({position:"static",visibility:"hidden",display:"block"}).appendTo(this.columns.eq(h)),f=j.outerHeight();var g=j.find("img");0!==g.length&&g.each(function(){var l=c(this),k=e(l),m=l.width()*k.height/k.width;f+=m}),j.detach().css({position:"static",visibility:"visible"})}else{f=parseInt(j.find("img").attr("height"),10)}j.attr("id")||j.attr("id",this.generateUniqueId());var i=this.items.toArray();i.push(j),this.items=c(i),this.itemsHeights[j.attr("id")]=f,this.columnsHeights[h]+=f,this.columns.eq(h).append(j),this.levelBottomEdge(this.itemsHeights,this.columnsHeights),this.container.trigger("mosaicflow-layout"),this.container.trigger("added")},remove:function(g){this.container.trigger("remove");var f=g.parents("."+this.options.columnClass);this.columnsHeights[f.index()-1]-=this.itemsHeights[g.attr("id")],g.detach(),this.items=this.items.not(g),this.levelBottomEdge(this.itemsHeights,this.columnsHeights),this.container.trigger("mosaicflow-layout"),this.container.trigger("removed")},empty:function(){var h=this.numberOfColumns;this.items=c([]),this.itemsHeights={};for(var g=0;h>g;g++){var f=this.columns.eq(g);this.columnsHeights[g]=0,f.empty()}this.container.trigger("mosaicflow-layout")},recomputeHeights:function(){function f(l,m){m=c(m);var k=0;k=i.autoCalculation?m.outerHeight():parseInt(m.find("img").attr("height"),10),i.itemsHeights[m.attr("id")]=k,i.columnsHeights[h]+=k}for(var i=this,j=this.numberOfColumns,h=0;j>h;h++){var g=this.columns.eq(h);this.columnsHeights[h]=0,g.children().each(f)}},generateUniqueId:function(){return this.__uidItemCounter++,"mosaic-"+this.__uid+"-itemid-"+this.__uidItemCounter}},c(function(){c(".mosaicflow").mosaicflow()})});